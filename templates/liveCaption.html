{{define "liveCaptionPage"}}
<!DOCTYPE html>
<html>
	<head>
		{{template "header"}}
		<script>
			var styleSheet
			function updateCSS (selector, property, value) {
				for (var x = 0; x < styleSheet.length; x++) {
						if (styleSheet[x].selectorText == selector) {
							styleSheet[x].style[property] = value
						}
					}
			}
			var elementToClass = {
				"gurbani"					:	".gurmukhifont",
				"english-translation"		:	".translation",
				"punjabi-translation"		:	".darpan",
				"english-transliteration"	:	".transliteration"
			}

			$(window).load(function () {
				styleSheet = $($("iframe").contents()[0].styleSheets).last()[0].rules
				$("iframe")[0].contentWindow.defaultHTML = '<div class="shabad" data-shabadid="0"><div id="0" class="line active"><div><div class="gurmukhifont"><div><div>gurbwxI</div></div></div><div class="translation">Translation</div><div class="darpan">ਪਨਜਾਬੀ ਅਰਥ</div><div class="transliteration">gurbaanee</div></div></div></div>'
				var selector = "body.presentation .active "

				$("input").change( function() {
					if (this.type == "color") {
						updateCSS(selector + elementToClass[$(this).parents(".options").data("for")],"color",this.value)
						$(this).parents(".popup").siblings(".label").css("background",this.value)
					} else {
						var settingName = this.id
						var item, property, value
						var setting = this.type == "checkbox" ? $(this).prop('checked') : this.value
						if (settingName == "position-top") {
							updateCSS ( selector + ".line > div", "justify-content", "flex-" + (setting ? "start" : "end"))
						} else if (settingName == "green-screen") {
							// updateCSS ( "body", "background", (setting ? "green" : "none"))
						} else {
							updateCSS ( selector + elementToClass[settingName], "display", setting ? "block" : "none")
						}
					}
				});

				$(".popup.color > div > div").click(function(){
					updateCSS(selector + elementToClass[$(this).parents(".options").data("for")],"color",$(this).data("color"))
					$(this).parents(".popup").siblings(".label").css("background",$(this).data("color"))
				})

				$(".popup.shadow > div > div").click(function(){
					updateCSS(selector + elementToClass[$(this).parents(".options").data("for")],"text-shadow", this.className == "none" ? "" : "0.5vh 0.5vh " + ($("#green-screen").prop('checked') ? " " : "2vh ") + this.className)
					$(this).parents(".popup").siblings(".label").css("background",this.className)
				})

				$(".popup.background > div > div").click(function(){
					var color = this.className == "none" ? "" : "#" + (this.className == "white" ? "FFFFFF" : "000000") + ($("#checkbox-1").prop("checked") ? "80" : "FF")
					updateCSS(selector + elementToClass[$(this).parents(".options").data("for")] + " > div > div","background", color)
					$(this).parents(".popup").siblings(".label").css("background",this.className)
				})

				$(".popup.window > div > div").click(function(){
					var color = this.className == "none" ? "" : "#" + (this.className == "white" ? "FFFFFF" : "000000") + ($("#checkbox-2").prop("checked") ? "80" : "FF")
					updateCSS(selector + elementToClass[$(this).parents(".options").data("for")],"background", color)
					$(this).parents(".popup").siblings(".label").css("background",this.className)
				})

				$(".smaller, .larger", ".font-size-changer").click(function(){
					var fontSize = $(this).siblings(".value").data("value") + (this.className == "smaller" ? -0.25 : 0.25)
					$(this).siblings(".value").data("value", fontSize).text(fontSize+"vh")
					updateCSS(selector + elementToClass[$(this).parents(".options").data("for")],"font-size", fontSize+"vh")
				})

				$(document).bind('click', function(e) {
					if (!$(e.target).parents(".chooser").length) $(".popup").hide()
				})

				$(".label").click(function(){
					var popup = $(this).siblings()
					popup.toggle()
					$(".popup").not(popup).hide()
				})

				$("#copy-css").click(function() {
					var cssString = ""
					$(styleSheet).each(function (index) {
						cssString += this.cssText + "\n"
					})
					alert(cssString)
				})

				$("#copy-link").click(function() {
					alert(window.location.origin+'/obs')
				})

				$("#save-default").click(function() {
				})

			})

			function iFrameResize() {
				var w = $('div.preview').width();
				var h = $('div.preview').height();
				// 16/9 = 1.777 recurring
				if (w/h >= 1.7777777) {
					//element is too wide to fit preview, size preview to max-height and trim width
					w = h * 16 / 9;
				} else {
					//opposite logic
					h = w / 16 * 9;
				}
                $('div.preview > iframe').height(h);
                $('div.preview > iframe').width(w);
			}
			$(document).ready(iFrameResize);
			$(window).resize(iFrameResize);

            $(function () {
                $("#english-translation").prop('checked', true)
				$("#gurbani").prop('checked', true)
        	});
		</script>
    </head>
<html>
	<body class="liveCaption {{.Theme}}">
		{{template "dragBorders"}}
		{{template "titlebarCloseable" .}}
		<div class="titlebaroffsetissue"></div>
		<div class="preview">
      		<iframe src="obs" width="1280" height="720" class="iframe"></iframe>
		</div>
		<div class="settings">
			<div class="c1">
				<p>Macro</p>
				<div>
    			<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="position-top">
            	<input type="checkbox" id="position-top" class="mdl-switch__input">
            	<span class="mdl-switch__label">Top Captions</span>
        	</label>
        	<p style="margin-top: .75em;">Margins</p>
        	<p style="width:100%; ">
            	<input id="margin" class="mdl-slider mdl-js-slider" type="range" min="0" max="10" value="10" step="1">
        	</p>
        	<p style="margin-top: .75em;">Width</p>
        	<p style="width:100%; ">
            	<input id="width" class="mdl-slider mdl-js-slider" type="range" min="50" max="100" value="100" step="1">
        	</p>
        	<p style="font-size: 0.85em; margin-top: .75em;">The following setting is for broadcasting programs that lack support for transparent backgrounds. Modern broadcasting programs, including OBS, support transparency. Please see the tutorial for more information.</p>
    			<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="green-screen">
            	<input type="checkbox" id="green-screen" class="mdl-switch__input">
            	<span class="mdl-switch__label">Green Screen</span>
        	</label>
				</div>
			</div>
			<div class="c2">
				<p>Appearance</p>
				<div>
					<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="gurbani">
						<input type="checkbox" id="gurbani" class="mdl-switch__input">
						<div id="font-color" class="chooser"></div>
						<span class="mdl-switch__label">Gurbani</span>
					</label>
					<div class="options" data-for="gurbani">
						{{template "obsOptions"}}
					</div>
					<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="english-translation">
						<input type="checkbox" id="english-translation" class="mdl-switch__input">
						<span class="mdl-switch__label">English Translation</span>
					</label>
					<div class="options" data-for="english-translation">
						{{template "obsOptions"}}
					</div>
					<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="punjabi-translation">
						<input type="checkbox" id="punjabi-translation" class="mdl-switch__input">
						<span class="mdl-switch__label">Punjabi Translation</span>
					</label>
					<div class="options" data-for="punjabi-translation">
						{{template "obsOptions"}}
					</div>
					<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="english-transliteration">
						<input type="checkbox" id="english-transliteration" class="mdl-switch__input">
						<span class="mdl-switch__label">English Transliteration</span>
					</label>
					<div class="options" data-for="english-transliteration">
						{{template "obsOptions"}}
					</div>
				</div>
			</div>
			<div class="c3">
				<p>Controls</p>
				<div>
          <button id="copy-link" class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Copy Link
          </button>
          <button id="copy-css" class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Copy CSS
          </button>
          <button id="save-default" class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Save Default
          </button>
          <button class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Help
          </button>
          <button class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Reset
          </button>
          <button class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Exit
          </button>
				</div>
			</div>
		</div>
	</body>
</html>
{{end}}
